# ==============================================================================
# Horizontal Pod Autoscaler (HPA): Auto-Scaling
# ==============================================================================
# Otomatis tambah/kurangi jumlah pod berdasarkan CPU/Memory usage
# Traffic naik → Pod bertambah | Traffic turun → Pod berkurang
# Benefit: Hemat cost & maintain performance

# HPA untuk App Deployment
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: culturaltrip-app-hpa
  namespace: culturaltrip
spec:
  scaleTargetRef:  # Target yang mau di-scale
    apiVersion: apps/v1
    kind: Deployment
    name: culturaltrip-app
  minReplicas: 3  # Minimum pod yang selalu jalan
  maxReplicas: 10  # Maximum pod saat traffic tinggi
  metrics:  # Trigger untuk scaling
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70  # Scale up jika CPU > 70%
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 80  # Scale up jika Memory > 80%
---
# HPA untuk Queue Worker
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: culturaltrip-queue-hpa
  namespace: culturaltrip
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: culturaltrip-queue
  minReplicas: 2
  maxReplicas: 5
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 80
